<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Christmas Friend</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      min-height: 100vh; 
      font-family: 'Georgia', serif; 
      color: #fff; 
      overflow: hidden; 
      position: relative;
    }
    
    /* Animated Christmas Background */
    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a4d3c 0%, #8b0000 50%, #0a4d3c 100%);
      animation: bgShift 15s ease-in-out infinite;
      z-index: 0;
    }
    
    @keyframes bgShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    /* Christmas Tree Pattern Overlay */
    .tree-pattern {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(220, 20, 60, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(34, 139, 34, 0.05) 0%, transparent 70%);
      animation: patternMove 20s linear infinite;
      z-index: 1;
    }
    
    @keyframes patternMove {
      0% { transform: translate(0, 0) rotate(0deg); }
      100% { transform: translate(50px, 50px) rotate(360deg); }
    }
    
    /* Animated Snowflakes */
    .snowflake {
      position: fixed;
      top: -10px;
      color: #fff;
      font-size: 1.5em;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
      animation: fall linear infinite;
      z-index: 2;
      pointer-events: none;
    }
    
    @keyframes fall {
      to { 
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* Twinkling Christmas Lights */
    .light {
      position: fixed;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: twinkle 2s ease-in-out infinite;
      z-index: 2;
      box-shadow: 0 0 20px currentColor;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.2); }
    }
    
    /* Floating Ornaments */
    .ornament {
      position: fixed;
      font-size: 2em;
      animation: float 6s ease-in-out infinite;
      z-index: 2;
      pointer-events: none;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }
    
    /* Main Container */
    .container {
      position: relative;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .content-box {
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(10px);
      border-radius: 30px;
      padding: 50px 40px;
      max-width: 600px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
                  0 0 0 1px rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      animation: boxGlow 3s ease-in-out infinite;
    }
    
    @keyframes boxGlow {
      0%, 100% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 215, 0, 0.3); }
      50% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 50px rgba(255, 215, 0, 0.5); }
    }
    
    h1 {
      font-size: 2.2em;
      margin-bottom: 30px;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.8),
                   0 0 40px rgba(255, 215, 0, 0.4);
      animation: titlePulse 2s ease-in-out infinite;
    }
    
    @keyframes titlePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .greeting {
      font-size: 1.5em;
      margin-bottom: 30px;
      color: #98fb98;
      text-shadow: 0 0 10px rgba(152, 251, 152, 0.6);
    }
    
    /* Reveal Card */
    .reveal-card {
      perspective: 1000px;
      margin: 40px auto;
      width: 300px;
      height: 400px;
      cursor: pointer;
    }
    
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    
    .reveal-card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .card-front {
      background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
      border: 3px solid #ffd700;
      animation: cardBounce 2s ease-in-out infinite;
    }
    
    @keyframes cardBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .card-front-content {
      text-align: center;
    }
    
    .gift-icon {
      font-size: 6em;
      margin-bottom: 20px;
      animation: giftWiggle 1s ease-in-out infinite;
    }
    
    @keyframes giftWiggle {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }
    
    .card-front h2 {
      color: #fff;
      font-size: 1.5em;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }
    
    .card-back {
      background: linear-gradient(135deg, #228b22 0%, #006400 100%);
      transform: rotateY(180deg);
      border: 3px solid #ffd700;
      position: relative;
      overflow: hidden;
    }
    
    .sparkles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #ffd700;
      border-radius: 50%;
      animation: sparkleAnim 1.5s ease-out forwards;
      box-shadow: 0 0 10px #ffd700;
    }
    
    @keyframes sparkleAnim {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(3); opacity: 0; }
    }
    
    .friend-name {
      font-size: 2em;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
      padding: 20px;
      word-wrap: break-word;
    }
    
    .hint {
      color: #ffd700;
      font-size: 1.2em;
      margin-top: 20px;
      animation: hintBlink 1.5s ease-in-out infinite;
    }
    
    @keyframes hintBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .quote {
      margin-top: 40px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      font-style: italic;
      color: #f0e68c;
      font-size: 1.1em;
      line-height: 1.6;
      border-left: 4px solid #ffd700;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    .error {
      padding: 25px;
      border-radius: 12px;
      background: rgba(220, 20, 60, 0.2);
      border: 2px solid rgba(220, 20, 60, 0.5);
      color: #ffb6c1;
      font-size: 1.2em;
    }
    
    @media (max-width: 768px) {
      h1 { font-size: 1.6em; }
      .greeting { font-size: 1.2em; }
      .reveal-card { width: 250px; height: 350px; }
      .gift-icon { font-size: 4em; }
      .quote { font-size: 1em; padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="background"></div>
  <div class="tree-pattern"></div>

  <div class="container">
    <div class="content-box">
      <h1>üéÖ Don't you want to see your Christmas Friend! üéÑ</h1>
      <div id="content"></div>
    </div>
  </div>

  <script>
    const USED_KEY_PREFIX = 'christmas_friend_used_';
    const ASSIGNMENTS_KEY = 'christmas_assignments';
    const STUDENTS_KEY = 'christmas_students';

    let studentNames = {
  's1': 'Saheen', 's2': 'Navrag', 's3': 'Kavya', 's4': 'Vijay',
  's5': 'Rasvitha', 's6': 'Shijin', 's7': 'Kevin', 's8': 'Melwyn',
  's9': 'Alan', 's10': 'Jinsha', 's11': 'Victor', 's12': 'Nithya',
  's13': 'Jonathan', 's14': 'Prof.BalaSubrahmani', 's15': 'Monica', 's16': 'Tony',
  's17': 'Devangana', 's18': 'Anisha', 's19': 'Kirthana', 's20': 'Snigdha',
  's21': 'Asfa', 's22': 'Navanetha', 's23': 'Justin', 's24': 'Sharon',
  's25': 'Alex', 's26': 'Sharon', 's27': 'Benet', 's28': 'Deeksha',
  's29': 'Rifa', 's30': 'Nithin', 's31': 'Calvin', 's32': 'Siddharth',
  's33': 'Srethul', 's34': 'Chantal', 's35': 'Supriya', 's36': 'Vaishnavi',
  's37': 'Felix', 's38': 'Khavya', 's39': 'Jomin', 's40': 'George',
  's41': 'Shuba', 's42': 'Mounish', 's43': 'Poornima', 's44': 'Ashwin',
  's45': 'Joshua', 's46': 'Goutham Sathya', 's47': 'Aron', 's48': 'Sebastian',
  's49': 'Arbiya', 's50': 'Riya', 's51': 'Cyrus', 's52': 'Dorjith',
  's53': 'Bharath', 's54': 'Gowtham P', 's55': 'Ann Sital', 's56': 'Nakshatra',
  's57': 'Nivedh', 's58': 'Diaz', 's59': 'Rebecca', 's60': 'Nayan'
};

let assignments = {
  's1': 'Devangana',
  's2': 'Bharath',
  's3': 'Navrag',
  's4': 'Alan',
  's5': 'Chantal',
  's6': 'Nithin',           // Shijin ‚Üí Nithin (updated)
  's7': 'Nakshatra',
  's8': 'Kirthana',
  's9': 'Melwyn',
  's10': 'Riya',
  's11': 'Navanetha',
  's12': 'Jomin',
  's13': 'Ashwin',
  's14': 'Sharon',          // Prof.BalaSubrahmani ‚Üí Sharon (updated)
  's15': 'Calvin',
  's16': 'Victor',
  's17': 'Annette',         // Snigdha ‚Üí Annette (updated)
  's18': 'Supriya',
  's19': 'Vijay',
  's20': 'Vaishnavi',
  's21': 'Kavya',
  's22': 'Jinsha',
  's23': 'Rasvitha',
  's24': 'Benet',
  's25': 'Cyrus',
  's26': 'Benet',
  's27': 'Felix',           // Anisha ‚Üí Benet (updated)
  's28': 'Nithya',
  's29': 'Khavya',
  's30': 'Shijin',
  's31': 'Goutham Sathya',
  's32': 'Poornima',
  's33': 'Srethul',         // Nivedh ‚Üí Srethul (updated)
  's34': 'Prof.BalaSubrahmani',
  's35': 'Aron',
  's36': 'Sebastian',
  's37': 'Mounish',
  's38': 'Monica',
  's39': 'Nayan',
  's40': 'George',          // Rebecca ‚Üí George (updated)
  's41': 'Jonathan',
  's42': 'Diaz',
  's43': 'Deeksha',
  's44': 'Ashwin',          // Sharon ‚Üí Ashwin (updated)
  's45': 'Alex',            // Joshua ‚Üí Alex (already correct)
  's46': 'Annette',
  's47': 'Tony',
  's48': 'Sebastian',       // Justin ‚Üí Sebastian (updated)
  's49': 'Rifa',
  's50': 'Joshua',
  's51': 'Srethul',
  's52': 'Shuba',
  's53': 'Arbiya',
  's54': 'Dorjith',
  's55': 'Siddharth',
  's56': 'Asfa',
  's57': 'Gowtham P',
  's58': 'Kevin',
  's59': 'George',
  's60': 'Ann Sital'
};



    function loadFromStorage() {
      try {
        const a = localStorage.getItem(ASSIGNMENTS_KEY);
        if (a) {
          const parsed = JSON.parse(a);
          if (parsed && typeof parsed === 'object') assignments = parsed;
        }
      } catch (e) { console.warn('failed loading assignments', e); }

      try {
        const s = localStorage.getItem(STUDENTS_KEY);
        if (s) {
          const parsedStudents = JSON.parse(s);
          if (Array.isArray(parsedStudents)) {
            const mapping = {};
            parsedStudents.forEach(st => { mapping[st.id] = st.name; });
            studentNames = mapping;
          }
        }
      } catch (e) { console.warn('failed loading students', e); }
    }

    function getStudentIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('student');
    }

    function hasUsed(id) {
      return localStorage.getItem(USED_KEY_PREFIX + id) === 'true';
    }

    function markUsed(id) {
      localStorage.setItem(USED_KEY_PREFIX + id, 'true');
      localStorage.setItem('christmas_friend_done', 'true');
      localStorage.setItem('christmas_friend_opened', id);
    }

    function showError(message) {
      const content = document.getElementById('content');
      content.innerHTML = '<div class="error">'+message+'</div>';
    }

    function getRandomQuote() {
      const christmasQuotes = [
        "Christmas is not just a day, it's a feeling. May your heart be filled with warmth, joy, and the magic of giving this season!",
        "The best gift around the Christmas tree is the presence of family and friends wrapped in love. Cherish every moment!",
        "Christmas waves a magic wand over the world, and behold, everything is softer and more beautiful. Spread kindness wherever you go!",
        "May your Christmas sparkle with moments of love, laughter, and goodwill. Remember, the joy of brightening someone's day is the true spirit of Christmas!",
        "Christmas is doing a little something extra for someone. Your kindness and thoughtfulness make the world a better place!",
        "The magic of Christmas never ends, and its greatest gifts are family and friends. May this season bring you closer to those you love!"
      ];
      return christmasQuotes[Math.floor(Math.random() * christmasQuotes.length)];
    }

    function createSnowflakes() {
      for (let i = 0; i < 30; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = '‚ùÑ';
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
        snowflake.style.animationDelay = Math.random() * 5 + 's';
        snowflake.style.fontSize = (Math.random() * 1 + 0.5) + 'em';
        document.body.appendChild(snowflake);
      }
    }

    function createLights() {
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffd700', '#ff69b4', '#00ffff'];
      for (let i = 0; i < 20; i++) {
        const light = document.createElement('div');
        light.className = 'light';
        light.style.left = Math.random() * 100 + '%';
        light.style.top = Math.random() * 100 + '%';
        light.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        light.style.animationDelay = Math.random() * 3 + 's';
        light.style.animationDuration = (Math.random() * 2 + 2) + 's';
        document.body.appendChild(light);
      }
    }

    function createOrnaments() {
      const ornaments = ['üî¥', 'üü¢', 'üîµ', 'üü°', '‚≠ê', 'üéÅ', 'üéÑ', 'üîî'];
      for (let i = 0; i < 8; i++) {
        const ornament = document.createElement('div');
        ornament.className = 'ornament';
        ornament.textContent = ornaments[Math.floor(Math.random() * ornaments.length)];
        ornament.style.left = Math.random() * 90 + '%';
        ornament.style.top = Math.random() * 80 + 10 + '%';
        ornament.style.animationDelay = Math.random() * 6 + 's';
        ornament.style.animationDuration = (Math.random() * 4 + 4) + 's';
        document.body.appendChild(ornament);
      }
    }

    function initRevealCard(friendName, studentId, studentName) {
      const content = document.getElementById('content');
      content.innerHTML = '';

      const greeting = document.createElement('div');
      greeting.className = 'greeting';
      greeting.textContent = `Hi ${studentName}! Happy Christmas! üåü`;
      content.appendChild(greeting);

      const revealCard = document.createElement('div');
      revealCard.className = 'reveal-card';

      const cardInner = document.createElement('div');
      cardInner.className = 'card-inner';

      const cardFront = document.createElement('div');
      cardFront.className = 'card-front';
      cardFront.innerHTML = `
        <div class="card-front-content">
          <div class="gift-icon">üéÅ</div>
          <h2>Click Me! üéÖ</h2>
        </div>
      `;

      const cardBack = document.createElement('div');
      cardBack.className = 'card-back';
      const sparklesDiv = document.createElement('div');
      sparklesDiv.className = 'sparkles';
      cardBack.appendChild(sparklesDiv);

      const friendDiv = document.createElement('div');
      friendDiv.className = 'friend-name';
      friendDiv.textContent = friendName;
      cardBack.appendChild(friendDiv);

      cardInner.appendChild(cardFront);
      cardInner.appendChild(cardBack);
      revealCard.appendChild(cardInner);
      content.appendChild(revealCard);

      const hint = document.createElement('p');
      hint.className = 'hint';
      hint.textContent = '‚ú® Click the gift to reveal your Christmas friend! ‚ú®';
      content.appendChild(hint);

      const quote = document.createElement('div');
      quote.className = 'quote';
      quote.textContent = `"${getRandomQuote()}"`;
      content.appendChild(quote);

      cardFront.addEventListener('click', () => {
        revealCard.classList.add('flipped');
        markUsed(studentId);
        for (let i = 0; i < 30; i++) {
          const sparkle = document.createElement('div');
          sparkle.className = 'sparkle';
          sparkle.style.left = Math.random() * 100 + '%';
          sparkle.style.top = Math.random() * 100 + '%';
          sparklesDiv.appendChild(sparkle);
          setTimeout(() => sparkle.remove(), 1600);
        }
        hint.style.display = 'none';
      });
    }

    (function main() {
      createSnowflakes();
      createLights();
      createOrnaments();
      loadFromStorage();

      const studentId = getStudentIdFromUrl();
      if (!studentId) {
        showError('‚ùå Invalid link. Please use the main list to open your name.');
        return;
      }

      if (!assignments[studentId]) {
        showError('‚ùå No Christmas friend found for this link.');
        return;
      }

      const done = localStorage.getItem('christmas_friend_done') === 'true';
      const openedId = localStorage.getItem('christmas_friend_opened');

      if (done && openedId !== studentId) {
        showError('üéÑ You have already opened one Christmas friend on this device. You can only reveal one friend.');
        return;
      }

      if (hasUsed(studentId)) {
        showError('üéÑ You have already opened this link on this device.');
        return;
      }

      const friendName = assignments[studentId];
      const studentName = studentNames[studentId] || 'Friend';
      initRevealCard(friendName, studentId, studentName);
    })();
  </script>
</body>
</html>
