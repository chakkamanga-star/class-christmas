<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Christmas Friend - Pick Your Name</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* (styles unchanged from original file) */
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Courier New', sans-serif;
      color: #fff;
      background: linear-gradient(135deg, #1b2735 0%, #090a0f 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      position: relative;
      overflow-x: hidden;
    }
    /* ... (rest of CSS same as before) ... */
    .lights { position: fixed; top: 0; left: 0; width: 100%; height: 60px; z-index: 100; display:flex; justify-content:space-around; pointer-events:none; }
    .snow { position: fixed; top: 0; left: 0; width:100%; height:100%; pointer-events:none; z-index:0; }
    .container { position: relative; z-index: 10; max-width: 600px; width:100%; background: rgba(0,0,0,0.5); border-radius:20px; padding:30px; margin-top:80px; }
    .list { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:20px; }
    .student { flex: 1 0 40%; max-width:45%; text-align:center; padding:14px 10px; border-radius:12px; background: rgba(255,255,255,0.1); color:#fff; font-weight:bold; text-decoration:none; border:2px solid rgba(255,255,255,0.3); cursor:pointer; transition: all 0.3s ease; position: relative; overflow:hidden; }
    .student.disabled { cursor: not-allowed; opacity: 0.4; background: rgba(0,0,0,0.4); box-shadow:none; }
    .admin-btn { position: fixed; bottom: 20px; right: 20px; padding: 12px 20px; border-radius:50px; text-decoration:none; }
    /* keep other styling omitted for brevity; use your original styles */
  </style>
</head>
<body>
  <div class="lights">
    <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
    <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
  </div>

  <div class="snow" id="snow"></div>

  <div class="container">
    <h1>üéÑ It's Christmas Time My Dear! üéÅ</h1>
    <p>Click on <strong>your own name</strong> only. Bala Sir watches Everything.</p>

    <div id="studentList" class="list"></div>

    <p class="note">‚ú® Once you open your Christmas friend, your name will be locked on this device. ‚ú®</p>
  </div>

  <a href="admin.html" class="admin-btn">üîê Admin</a>

  <script>
    // Shared localStorage keys (same keys admin uses)
    const STUDENTS_KEY = 'christmas_students';
    const ASSIGNMENTS_KEY = 'christmas_assignments';
    const USED_KEY_PREFIX = 'christmas_friend_used_';

    // Default list (kept as fallback)
    let students = [
      { id: 's1',  name: 'MUHAMMED SAHEEN NV' },
      { id: 's2',  name: 'Navrag K' },
      { id: 's3',  name: 'Kavya Shree KS' },
      { id: 's4',  name: 'Vijay Sherpa' },
      { id: 's5',  name: 'Rasvitha R' },
      { id: 's6',  name: 'Shijin Shaji' },
      { id: 's7',  name: 'Kevin Palakar' },
      { id: 's8',  name: 'Melwyn Ezekiel Nelson' },
      { id: 's9',  name: 'Alan John' },
      { id: 's10', name: 'Jinsha P' },
      { id: 's11', name: 'Ck Victor' },
      { id: 's12', name: 'S. Nithya Shree' },
      { id: 's13', name: 'Kalakotla Jonathan' },
      { id: 's14', name: 'Staines Joy' },
      { id: 's15', name: 'Monica P' },
      { id: 's16', name: 'Tony Paul P' },
      { id: 's17', name: 'Devangana M Nair' },
      { id: 's18', name: 'Anisha Anand' },
      { id: 's19', name: 'Kirthana B' },
      { id: 's20', name: 'Snigdha P' },
      { id: 's21', name: 'Asfa Naaz' },
      { id: 's22', name: 'M Navanetha' },
      { id: 's23', name: 'Justin Johnson' },
      { id: 's24', name: 'Sharon Godfrey' },
      { id: 's25', name: 'Nitin K' },
      { id: 's26', name: 'Benet Kalunkil Babu' },
      { id: 's27', name: 'Annette Jerry Pereira' },
      { id: 's28', name: 'Deeksha MB' },
      { id: 's29', name: 'Fathimath Rifa' },
      { id: 's30', name: 'Budda Samuel Alex' },
      { id: 's31', name: 'Calvin Richard V' },
      { id: 's32', name: 'Siddharth L' },
      { id: 's33', name: 'Ashwin Victor J' },
      { id: 's34', name: 'Chantal Rachel Rebeiro' },
      { id: 's35', name: 'Supriya Agnes J' },
      { id: 's36', name: 'Vaishnavi R' },
      { id: 's37', name: 'M Felix Francis' },
      { id: 's38', name: 'K Khavya Shree' },
      { id: 's39', name: 'Jomin S George' },
      { id: 's40', name: 'Sebastian' },
      { id: 's41', name: 'S Shuba Zion' },
      { id: 's42', name: 'Mounish' },
      { id: 's43', name: 'Poornima R' },
      { id: 's44', name: 'Srethul' },
      { id: 's45', name: 'Joshua' },
      { id: 's46', name: 'Goutham' },
      { id: 's47', name: 'Aron' },
      { id: 's48', name: 'George' },
      { id: 's49', name: 'Arbiya' },
      { id: 's50', name: 'Riya' },
      { id: 's51', name: 'Cyrus' },
      { id: 's52', name: 'Dorjith' },
      { id: 's53', name: 'Bharath' },
      { id: 's54', name: 'Gowtham' },
      { id: 's55', name: 'Supriya' },
      { id: 's56', name: 'Nakshatra' },
      { id: 's57', name: 'Nivedh' },
      { id: 's58', name: 'Diaz' },
      { id: 's59', name: 'Rebecca' },
      { id: 's60', name: 'Nayan' },
      { id: 's61', name: 'Ann Sital' },
      { id: 's62', name: 'Prof.BalaSubrahmani' }
    ];

    // Try to load students from localStorage (saved by admin)
    function loadStudentsFromStorage() {
      try {
        const raw = localStorage.getItem(STUDENTS_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          // ensure parsed looks like the expected array
          if (Array.isArray(parsed) && parsed.length) {
            students = parsed;
          }
        }
      } catch (e) { console.warn('Failed parsing students from storage', e); }
    }

    function hasUsed(id) {
      return localStorage.getItem(USED_KEY_PREFIX + id) === 'true';
    }

    // Render the student list, taking into account the global 'done' flag
    function renderStudents() {
      loadStudentsFromStorage(); // ensure up-to-date list
      const listEl = document.getElementById('studentList');
      listEl.innerHTML = '';

      const done = localStorage.getItem('christmas_friend_done') === 'true';
      const openedId = localStorage.getItem('christmas_friend_opened');

      students.forEach(student => {
        const used = hasUsed(student.id);
        const disabled = done ? true : used;

        const a = document.createElement('a');
        a.className = 'student' + (disabled ? ' disabled' : '');
        if (openedId && student.id === openedId) {
          a.textContent = student.name + ' ‚Äî (Your pick)';
          a.href = 'javascript:void(0)';
          a.title = 'You already revealed this friend.';
        } else {
          a.textContent = student.name;
          if (!disabled) {
            a.href = 'scratch.html?student=' + encodeURIComponent(student.id);
          } else {
            a.href = 'javascript:void(0)';
            a.title = 'Locked';
          }
        }
        listEl.appendChild(a);
      });
    }

    // animations and decorations (same logic as before)
    function createSnowflakes() {
      const snowContainer = document.getElementById('snow');
      for (let i = 0; i < 30; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = ['‚ùÑ', '‚ùÖ', '‚ùÜ'][Math.floor(Math.random() * 3)];
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
        snowflake.style.animationDelay = Math.random() * 5 + 's';
        snowflake.style.fontSize = (Math.random() * 1 + 0.5) + 'em';
        snowContainer.appendChild(snowflake);
      }
    }

    function createOrnaments() {
      const ornaments = ['üî¥', 'üü¢', 'üîµ', 'üü°', '‚≠ê', 'üéÅ'];
      for (let i = 0; i < 8; i++) {
        const ornament = document.createElement('div');
        ornament.className = 'ornament';
        ornament.textContent = ornaments[Math.floor(Math.random() * ornaments.length)];
        ornament.style.left = Math.random() * 90 + '%';
        ornament.style.top = Math.random() * 80 + 10 + '%';
        ornament.style.animationDelay = Math.random() * 3 + 's';
        document.body.appendChild(ornament);
      }
    }

    // init
    createSnowflakes();
    createOrnaments();
    renderStudents();
  </script>
</body>
</html>
